<?php
/**
 *
 *  _____                                                                                _____
 * ( ___ )                                                                              ( ___ )
 *  |   |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|   |
 *  |   |                                                                                |   |
 *  |   |                                                                                |   |
 *  |   |    ________  ___       __   _______   _______   ________                       |   |
 *  |   |   |\   __  \|\  \     |\  \|\  ___ \ |\  ___ \ |\   ____\                      |   |
 *  |   |   \ \  \|\  \ \  \    \ \  \ \   __/|\ \   __/|\ \  \___|_                     |   |
 *  |   |    \ \  \\\  \ \  \  __\ \  \ \  \_|/_\ \  \_|/_\ \_____  \                    |   |
 *  |   |     \ \  \\\  \ \  \|\__\_\  \ \  \_|\ \ \  \_|\ \|____|\  \                   |   |
 *  |   |      \ \_____  \ \____________\ \_______\ \_______\____\_\  \                  |   |
 *  |   |       \|___| \__\|____________|\|_______|\|_______|\_________\                 |   |
 *  |   |             \|__|                                 \|_________|                 |   |
 *  |   |    ________  ________  ________  _______   ________  ________  ________        |   |
 *  |   |   |\   ____\|\   __  \|\   __  \|\  ___ \ |\   __  \|\   __  \|\   __  \       |   |
 *  |   |   \ \  \___|\ \  \|\  \ \  \|\  \ \   __/|\ \  \|\  \ \  \|\  \ \  \|\  \      |   |
 *  |   |    \ \  \    \ \  \\\  \ \   _  _\ \  \_|/_\ \   ____\ \   _  _\ \  \\\  \     |   |
 *  |   |     \ \  \____\ \  \\\  \ \  \\  \\ \  \_|\ \ \  \___|\ \  \\  \\ \  \\\  \    |   |
 *  |   |      \ \_______\ \_______\ \__\\ _\\ \_______\ \__\    \ \__\\ _\\ \_______\   |   |
 *  |   |       \|_______|\|_______|\|__|\|__|\|_______|\|__|     \|__|\|__|\|_______|   |   |
 *  |   |                                                                                |   |
 *  |   |                                                                                |   |
 *  |___|~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|___|
 * (_____)                                                                              (_____)
 *
 * Эта программа является свободным программным обеспечением: вы можете распространять ее и/или модифицировать
 * в соответствии с условиями GNU General Public License, опубликованными
 * Фондом свободного программного обеспечения (Free Software Foundation), либо в версии 3 Лицензии, либо (по вашему выбору) в любой более поздней версии.
 *
 *
 * @license GPL-3.0-or-later (см. файл LICENSE.txt)
 * @author TimQwees
 * @link https://github.com/TimQwees/Qwees_CorePro
 *
 *
 */

namespace App\Models\Network;

use App\Config\Session;

class Message
{
  /**
   * **Установка уведомления для пользователя**
   *
   * _Сохраняет новое уведомление в cookie-сессию (через Session::init)._
   *
   * ---
   * **Параметры:**
   * - **$type** — _тип уведомления:_
   *   Например: `'success'`, `'error'`, `'info'`.
   * - **$message** — _текстовое сообщение уведомления_.
   *
   * ---
   * **Использование:**
   * _Пример:_
   * ```php
   * Message::set('success', 'Операция выполнена успешно');
   * ```
   *
   * ⮞ Сохраняет уведомление выбранного типа с произвольным текстом в cookie-сессию.
   *
   * @param string $type    Тип уведомления (например 'success', 'error', 'info')
   * @param string $message Сообщение
   * @return void
   */
  public static function set($type, $message)
  {
    Session::init('notification', [
      'type' => $type,
      'message' => $message
    ]);
  }

  /**
   * **Получение и удаление уведомления**
   *
   * _Извлекает уведомление пользователя из cookie-сессии и сразу его удаляет._
   *
   * ---
   * **Возвращает:**
   * - `array('type' => ..., 'message' => ...)` — если уведомление найдено
   * - `null` — если уведомления нет
   *
   * ---
   * **Пример вызова:**
   * ```php
   * Message::getAll();
   * ```
   *
   * @return array|null
   */
  public static function getAll()
  {
    $data = Session::init('notification') ?? null;
    if (is_array($data) && (isset($data['type']) || isset($data['message']))) {

      Session::init('notification', null);
      return [
        'type' => $data['type'] ?? '',
        'message' => $data['message'] ?? ''
      ];
    }
    return null;
  }

  /**
   * **Проверка наличия активного уведомления**
   *
   * _Выясняет, хранится ли уведомление сейчас в cookie-сессии._
   *
   * ---
   * **Возвращает:**
   * - `true` — если уведомление есть
   * - `false` — если уведомления нет
   *
   * ---
   * _Пример:_
   * ```php
   * if (Message::has()) { ... }
   * ```
   *
   * @return bool
   */
  public static function has()
  {
    $data = Session::init('notification') ?? null;
    return is_array($data) && isset($data['type']) && isset($data['message']);
  }

  /**
   * **Вернуть "пустое" уведомление**
   *
   * _Формирует структуру, где поля типа и текста уведомления — пустые строки._
   *
   * ---
   * **Возвращает:**
   * `['type' => '', 'message' => '']`
   *
   * ---
   * _Пример:_
   * ```php
   * $empty = Message::null();
   * ```
   *
   * @return array
   */
  public static function null()
  {
    return ['type' => '', 'message' => ''];
  }

  /**
   * **Универсальный вариант: получить актуальное уведомление**
   *
   * _Если уведомление существует — возвращает его и обнуляет, иначе возвращает пустую структуру._
   *
   * ---
   * **Точно гарантирует:**
   * - результат всегда будет массивом с ключами `'type'` и `'message'`
   * - если уведомления нет, значения будут пустыми
   *
   * ---
   * _Удобный пример:_
   * ```php
   * $notify = Message::controll();
   * ```
   *
   * @return array
   */
  public static function controll()
  {
    return self::has() ? self::getAll() : self::null();
  }

}
