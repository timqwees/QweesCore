<div align="center">
    <img src="https://github.com/timqwees/QweesCore/blob/view/assets/fline_original.png?raw=true" alt="QweesCore Logo" width="320">
  <div style="margin-top: 10px;max-width:450px">
    <a style="text-decoration:none" href="https://www.gnu.org/licenses/gpl-3.0" target="_blank">
      <img src="https://badgen.net/badge/license/GPL%203.0%20or%20later/green?icon=github" alt="License: GPL 3.0 or later" />
    </a>
    <a style="text-decoration:none" href="https://github.com/timqwees/qweescore" target="_blank">
      <img src="https://badgen.net/github/stars/timqwees/qweescore" alt="Stars QweesCore" />
    </a>
    <a style="text-decoration:none" href="https://github.com/timqwees/qweescore" target="_blank">
      <img src="https://badgen.net/badge/author/timqwees" alt="Stars QweesCore" />
    </a>
    <span>
      <img src="https://badgen.net/badge/php/%3E%3D7.4/8892BF" alt="Stars QweesCore" />
    </span>
    <a style="text-decoration:none" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank">
      <img src="https://badgen.net/badge/arch/MVC/green" alt="Architecture: MVC" />
    </a>
    <a style="text-decoration:none" href="https://www.php.net/manual/en/book.pdo.php" target="_blank">
      <img src="https://badgen.net/badge/uses/PDO/orange" alt="Uses: PDO" />
    </a>
    <a style="text-decoration:none" href="https://github.com/PHPMailer/PHPMailer" target="_blank">
      <img src="https://badgen.net/badge/integration/PHPMailer/purple" alt="Integration: PHPMailer" />
    </a>
    <a style="text-decoration:none" href="#">
      <img src="https://img.shields.io/badge/API-REST-brightgreen.svg" alt="API: REST">
    </a>
    <a style="text-decoration:none" href="#">
      <img src="https://img.shields.io/badge/format-JSON--API-e67e22.svg" alt="Format: JSON-API">
    </a>
  </div>
</div>

# QweesCore — Документация

> **Версия:** **`2.1.0`**
> **Автор:** [timqwees technology](https://github.com/timqwees)
> **Последнее обновление:** 15 декабря 2025 [21:30]

---

### Установка

Автоматический (рекомендуемый):

```bash
> npx qwees install <app_name>
```

Файл `index.php` в корне исполняет инициализацию Network и запускает роутер.

# Что нового в QweesCore 2.1.0

1. **Современная реактивность:** Переменные между роутером и страницами теперь синхронизируются мгновенно и без сторонних библиотек, что делает интерфейс ещё динамичнее.
2. **Надёжная система пользователей:** Полностью улучшена логика регистрации, входа и авторизации. Теперь все процессы работают автоматизировано и максимально прозрачно для разработчика.
3. **Гибкость и чистота в User:** Имя таблицы пользователей теперь задаётся отдельным свойством, а метод `getUser` сразу возвращает результаты — без лишних обёрток.
4. **Новый модуль статей:** Проведён глубокий рефакторинг статьи — стабильность и надёжность стали выше.
5. **Обновлены сессии:** Механизм работы сессий стал ещё безопаснее и предсказуемее.
6. **Корректная обработка ошибок:** Теперь ошибки роутинга чётко указывают путь к 404, а также правильно отображают методы (GET/POST), даже если ваша функция не найдена.
7. **Собственные API без усилий:** Просто определяйте свои API-прослойки через встроенный роутинг QweesCore — всё работает «из коробки»!

## Содержание

- [1. Требования](#1-требования)
- [2. Структура проекта](#2-структура-проекта)
- [3. Основные компоненты](#3-основные-компоненты)
- [4. Конфигурация](#4-конфигурация)
- [5. Маршрутизация](#5-маршрутизация--примеры)
- [6. Работа с базой данных и миграции](#6-работа-с-базой-данных-и-миграции)
- [7. Аутентификация](#7-аутентификация)
- [8. Отправка почты](#8-отправка-почты)
- [9. Система шаблонов и фронтенд](#9-система-шаблонов-и-фронтенд)
- [10. Система сообщений](#10-система-сообщений)
- [11. CLI и вспомогательные скрипты](#11-cli-и-вспомогательные-скрипты)
- [12. Работа с API и cURL](#12-работа-с-api-и-curl)
- [13. Безопасность и рекомендации](#13-безопасность-и-рекомендации)
- [14. Список изменений — релиз 2.0.0](#14-список-изменений--релиз-200)
- [15. Лицензия](#15-лицензия)
- [16. Автор](#16-автор)

---

### 1. Требования

- PHP 7.4+
- PDO с драйверами sqlite и mysql
- Composer для установки зависимостей
- SMTP доступ (опционально, если используется отправка почты)

---

### 2. Структура проекта

```
project/
│ index.php
│ composer.json
│ README.md
│
├── app/
│   ├── Config/           # Database.php, Environment, другие конфига-классы
│   ├── Controllers/      # AuthController, MailController, Functions и др.
│   ├── Models/           # Router, Network, Message, и т.д.
│   └── ...
├── public/
│   └── pages/            # Страницы (php/html) — шаблоны фронтенда
├── setting/
│   ├── route/            # область управления маршрутом и отображеним
│   ├── schema/           # schema.sql файлы миграций
└── ...
```

---

### 3. Основные компоненты

### Network (ядро)

Network отвечает за:

- запуск маршрутизации
- автозагрузку классов
- подключение к БД
- применение миграций из `setting/schema/schema.sql`
- отправку почты через PHPMailer
- обработку ошибок и исключений
- управление сессиями
- вспомогательные утилиты (рендеринг, работа с путями, получение конфигураций)

Network — центральная точка интеграции всех подсистем; он реализован как набор статических свойств/методов и легкой DI‑псевдосистемы (`Network::get(...)`, `Network::$patterns` и т.д.).

### Router

Роутер объявляет маршруты через API типа `Routes::get()`, `Routes::post()`. Поддерживает динамические сегменты, callback массивы (`[Controller::class, 'method']`) и анонимные функции. При соответствии маршрута роутер вызывает `Network::onRoute()`.

### Database

Абстрактный класс/класс конфигурации `Database.php` поддерживает два режима: `sqlite` и `mysql`. При первом запуске выполняется логика:

- чтение `setting/schema/schema.sql`
- парсинг CREATE TABLE инструкций
- проверка существования таблиц
- создание отсутствующих таблиц
- при необходимости преобразование типов SQL между SQLite и MySQL (например, `AUTOINCREMENT` → `AUTO_INCREMENT`)

Это позволяет запускать проект без явных миграций вручную — достаточно поместить актуальную схему.

### AuthController

Реализует регистрацию, авторизацию и выход. Процесс включает в себя проверку входных данных, безопасное хеширование паролей (рекомендуется password_hash), управление сессиями и защиту от простых ошибок (например, циклических редиректов).

### MailController

Интеграция с PHPMailer через helper `Network::onPHPMailer()`; конфигурация SMTP берётся из `.env`.

### auto_element (мини‑шаблонизатор)

Простейшая система подключения страниц: `Routes::auto_element()` выполняет проверку наличия файла, подключение и передачу путей. Файлы в `public/pages/` — обычные PHP/HTML шаблоны.

### Message

Система flash-сообщений, основанная на сессиях: `Message::set(type, message)`, `Message::getAll()` и пр.

---

### 4. Конфигурация

### `.env` (setting/.env)

Основные параметры:

- `DB_DRIVER` — sqlite | mysql
- `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASS` — для MySQL
- `SQLITE_FILE` — путь к файлу SQLite
- `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`, `SMTP_SECURE` — почта
- `APP_URL`, `APP_ENV` и др.

Философия: минимум конфигурации — sensible defaults + возможность полного управления через `.env`.

---

### 5. Маршрутизация — Примеры

```php
Routes::get('/', 'on_Main');
Routes::get('/docs', 'on_Docs');
Routes::post('/user/{id}', [UserController::class, 'update']);
```

Роуты с динамическими параметрами передают значения в целевой callback. Роутер хранит карты в `Network::$patterns['GET']` и `Network::$patterns['POST']`.

---

### 6. Работа с базой данных и миграции

### Принцип

- В `setting/schema/schema.sql` содержится canonical схема приложения
- При запуске Database читает файл, извлекает CREATE TABLE и применяет их в текущем движке СУБД
- Если движок отличается (sqlite ↔ mysql), выполняется трансляция специфичных конструкций

### Рекомендации

- Для сложных миграций применяйте версионирование схемы (добавляйте файл schema_vX.sql и управляйте применением вручную)
- Резервное копирование обязательнo перед массовыми изменениями

---

### 7. Аутентификация

### Алгоритм

1. Пользователь отправляет форму входа/регистрации
2. Контроллер (`AuthController`) валидирует данные
3. Пароль хешируется (password_hash) и сохраняется
4. После успешной авторизации в сессию записываются идентификаторы пользователя

### Безопасность

- Используйте `password_hash` / `password_verify` (BCRYPT/ARGON2)
- Ограничьте попытки входа (rate limit) на уровне фронта/веб‑сервера
- Храните минимальные необходимые данные в сессии

---

### 8. Отправка почты

Система использует PHPMailer (через Composer). Пример использования:

```php
(new MailController())->onMail($to, $subject, $body);
```

SMTP-настройки берутся из `.env`; в случае ошибки вызывается обработка исключений с записью в логи/Message.

---

### 9. Система шаблонов и фронтенд

QweesCore использует простую файловую организацию: `public/pages/{module}/{page}.php`. Файлы могут быть простым PHP/HTML, фреймворк не использует сложных шаблонизаторов по умолчанию.

`Routes::auto_element()` облегчает рендеринг: он проверяет наличие файла и подключает его в контексте общей страницы.

---

### 10. Система сообщений

Flash‑сообщения реализованы в классе `Message`. API:

- `Message::set($type, $text)` — задать сообщение
- `Message::getAll()` — получить массив сообщений и очистить

Используется для оповещений пользователя о результате операций.

---

### 11. CLI и вспомогательные скрипты

В проекте предусмотрены утилиты в `app/Config/CLI/`.

Набор действий:

`запуск проекта`

Команда для запуска:

* [X] qwees start
* [X] qwees run
* [X] run serve

---

### 12. Работа с API и cURL

QweesCore предоставляет современный универсальный способ создания и обслуживания API-эндпоинтов, полностью поддерживающий работу как из PHP-кода, так и через cURL или другие HTTP‑клиенты.

**1. Быстрая регистрация маршрутов API**

В файле `setting/route/routes.php` определяйте GET/POST‑эндпоинты как анонимными функциями, так и через штатный API‑класс:

```php
// Простейший GET-запрос
Routes::get('/api/hello', function() { echo API::send('/qwees.json'); });

// Пример POST-запроса — рекомендуется использовать встроенный API::send для корректного ответа
Routes::post('/api/send', fn() => print(API::send('/qwees.json')));
или
Routes::post('/api/hello', function() { echo API::send('/qwees.json'); });
```

**Пример реализации метода:**
```php
// setting/route/function/functions.php
public function on_API()
{
    echo API::send('/public/pages/main/qwees.json');
}
```

**2. Формат и специфика обработки (PHP и cURL)**

- Все API‑ответы возвращаются только в формате JSON + с корректным HTTP‑статусом.
- Любой вызов через `API::send()` или `API::request()` возвращает структуру:
    ```json
    {
      "status": "success" | "error" | "qwees_crash",
      "data": ...,
      "message": "...",
      "meta": {
        "method": "POST",
        "path": "/api/..."
      }
    }
    ```
- Поддержка cURL: просто укажите заголовок `Content-Type: application/json` и передайте данные через `-d`:
    ```bash
    curl -X POST https://example.com/api/... \
         -H "Content-Type: application/json" \
         -d '{"key":"value"}'
    ```
  Фреймворк автоматически обработает входящий JSON, обновит файл (при необходимости), всегда выдаст корректный статус (см. подробности в [`API`](app/Controllers/API/API.php)).
- Если данные не были переданы или неверны, клиенту будет возвращён статус "error" и поясняющее сообщение.
- Ответ всегда содержит всю контекстную информацию, что удобно для интеграций и тестирования через cURL.

---

### 13. Безопасность и рекомендации

- Обновляйте зависимости через Composer
- Проводите бэкапы БД и `.env`
- Не храните `.env` в публичных репозиториях
- Применяйте HTTPS в production
- Ограничьте права доступа к файлам и папкам

### 14. Список изменений — релиз 2.0.0

- Полная стабилизация и рефакторинг ядра Network: единый API доступа ко всем подсистемам, стандартизированные методы, централизованная обработка ошибок, более чистая архитектура во всём проекте.
- Расширенная поддержка миграций и схемы данных: Network теперь автоматически применяет schema.sql из папки setting/schema, адаптирует SQL‑инструкции под SQLite или MySQL, а также выполняет трансляцию ключевых отличий в синтаксисе (например, AUTOINCREMENT ↔ AUTO_INCREMENT). Больше не требуется ручная настройка миграций — всё в автоматическом режиме.
- Современный роутер: переработан механизм сопоставления маршрутов с добавлением поддержки callback массивов (например, [SomeController::class, 'method']), маршрутов с динамическими сегментами (/user/{id}), а также строгой проверки входных параметров. Более прозрачная логика поиска и вызова целевых endpoints.
- Интеграция PHPMailer: отправка почты теперь производится через единый API Network::onPHPMailer, все SMTP‑настройки — из .env, в случае ошибок реализована централизованная обработка и безопасное логгирование через Message.
- Система сообщений и сессий: полностью переработан класс Message для "flash" уведомлений (Message::set, Message::getAll), сообщения хранятся в сессиях и автоматически очищаются после показа.
- Документация и примеры: README и документация полностью обновлены в соответствии с новой архитектурой и возможностями версии 2.0.0, приводятся к единому стилю описания, добавлены актуальные примеры использования и рекомендации.
- Полное изменение архитектуры проекта.
- Полная поддержка 0 конфигурации.
- Полная изоляци яядра.

---

### 15. Лицензия

Проект распространяется под лицензией: `GPL-3.0-or-later`.

---

### 16. Автор

Автор фрамйворка: `timqwees technology`

Ссылка в ВК: [https://vk.com/mx999am99](https://vk.com/mx999am99)

Ссыылка в телеграм: [https://t.me/timqwees](https://t.me/timqwees)
